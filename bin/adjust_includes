#!/usr/bin/perl

use strict;
use experimental 'smartmatch';

# Changes prefix of symbol name in all source files (.cpp, .h, .tmpl, .l, .ll,
# .y, .fd) in and below directory in which the script is run.

my %ns =
(
	'jcore' =>
	[
		'JAliasArray.h',
		'JArray.h',
		'JArrayIterator.h',
		'JAssertBase.h',
		'JAsynchDataReceiver.h',
		'JAuxTableData.h',
		'JBroadcastSnooper.h',
		'JBroadcastTester.h',
		'JBroadcaster.h',
		'JCharacterRange.h',
		'JChooseSaveFile.h',
		'JCollection.h',
		'JColorManager.h',
		'JComplex.h',
		'JConstBitmap.h',
		'JConstHashCursor.h',
		'JContainer.h',
		'JCoreLibVersion.h',
		'JCreateProgressDisplay.h',
		'JCreateTextPG.h',
		'JDirEntry.h',
		'JDirInfo.h',
		'JEPSPrinter.h',
		'JError.h',
		'JErrorState.h',
		'JFAID.h',
		'JFAIndex.h',
		'JFileArray.h',
		'JFileArrayIndex.h',
		'JFileID.h',
		'JFloatBufferTableData.h',
		'JFloatTableData.h',
		'JFont.h',
		'JFontManager.h',
		'JFontStyle.h',
		'JHashCursor.h',
		'JHashRecord.h',
		'JHashTable.h',
		'JImage.h',
		'JImageMask.h',
		'JInterpolate.h',
		'JKLRand.h',
		'JLatentPG.h',
		'JLinkedList.h',
		'JLinkedListIterator.h',
		'JList.h',
		'JListIterator.h',
		'JListUtil.h',
		'JMDIServer.h',
		'JMMArrayTable.h',
		'JMMDebugErrorStream.h',
		'JMMErrorPrinter.h',
		'JMMHashTable.h',
		'JMMMonitor.h',
		'JMMRecord.h',
		'JMMTable.h',
		'JMatrix.h',
		'JMemoryManager.h',
		'JMessageProtocol.h',
		'JMinMax.h',
		'JNamedTreeList.h',
		'JNamedTreeNode.h',
		'JNetworkProtocolBase.h',
		'JObjTableData.h',
		'JOutPipeStream.h',
		'JOutPipeStreambuf.h',
		'JPSPrinter.h',
		'JPSPrinterBase.h',
		'JPTPrinter.h',
		'JPackedTableData.h',
		'JPagePrinter.h',
		'JPainter.h',
		'JPartition.h',
		'JPoint.h',
		'JPolygon.h',
		'JPrefObject.h',
		'JPrefsFile.h',
		'JPrefsManager.h',
		'JPrinter.h',
		'JProcess.h',
		'JProcessError.h',
		'JProgressDisplay.h',
		'JPtrArray-JString.h',
		'JPtrArray.h',
		'JPtrQueue.h',
		'JPtrStack.h',
		'JQueue.h',
		'JRTTIBase.h',
		'JRange.h',
		'JRect.h',
		'JRegex.h',
		'JRunArray.h',
		'JRunArrayIterator.h',
		'JSTStyler.h',
		'JSTUndoBase.h',
		'JSTUndoMove.h',
		'JSTUndoPaste.h',
		'JSTUndoStyle.h',
		'JSTUndoTabShift.h',
		'JSTUndoTextBase.h',
		'JSTUndoTyping.h',
		'JSimpleProcess.h',
		'JSliderBase.h',
		'JSpellChecker.h',
		'JStack.h',
		'JStdError.h',
		'JStopWatch.h',
		'JStrValue.h',
		'JString.h',
		'JStringIterator.h',
		'JStringManager.h',
		'JStringMap.h',
		'JStringMapCursor.h',
		'JStringMatch.h',
		'JStringPtrMap.h',
		'JStringPtrMapCursor.h',
		'JStringSplit.th',
		'JStringTableData.h',
		'JStyleTableData.h',
		'JStyledText.h',
		'JStyledTextSetFont.th',
		'JSubstitute.h',
		'JTEDefaultKeyHandler.h',
		'JTEKeyHandler.h',
		'JTable.h',
		'JTableData.h',
		'JTableSelection.h',
		'JTableSelectionIterator.h',
		'JTaskIterator.h',
		'JTestManager.h',
		'JTextChooseSaveFile.h',
		'JTextEditor.h',
		'JTextProgressDisplay.h',
		'JTextUserNotification.h',
		'JThisProcess.h',
		'JTree.h',
		'JTreeList.h',
		'JTreeNode.h',
		'JUndo.h',
		'JUserNotification.h',
		'JUtf8ByteBuffer.h',
		'JUtf8ByteRange.h',
		'JUtf8Character.h',
		'JVIKeyHandler.h',
		'JValueTableData.h',
		'JVector.h',
		'JVersionSocket.h',
		'JWebBrowser.h',
		'JXPM.h',
		'jASCIIConstants.h',
		'jAssert.h',
		'jColor.h',
		'jCommandLine.h',
		'jDirUtil.h',
		'jErrno.h',
		'jFStreamUtil.h',
		'jFileUtil.h',
		'jGlobals.h',
		'jHashFunctions.h',
		'jMath.h',
		'jMissingProto.h',
		'jMountUtil.h',
		'jMouseUtil.h',
		'jNew.h',
		'jProcessUtil.h',
		'jRand.h',
		'jSignal.h',
		'jStreamUtil.h',
		'jStringData.h',
		'jSysUtil.h',
		'jTextUtil.h',
		'jTime.h',
		'jTypes.h',
		'jVCSUtil.h',
		'jWebUtil.h',
		'jXMLUtil.h'
	],
	'jx' =>
	[
		'JXAcceptLicenseDialog.h',
		'JXAdjustIWBoundsTask.h',
		'JXAdjustPrintSetupLayoutTask.h',
		'JXAdjustScrollbarTask.h',
		'JXAdjustToolBarGeometryTask.h',
		'JXAnimationTask.h',
		'JXApplication.h',
		'JXAskInitDockAll.h',
		'JXAssert.h',
		'JXAtLeastOneCBGroup.h',
		'JXAtMostOneCBGroup.h',
		'JXBorderRect.h',
		'JXBusyIconTask.h',
		'JXButton.h',
		'JXButtonStates.h',
		'JXCSFDialogBase.h',
		'JXCSFSelectPrevDirTask.h',
		'JXCardFile.h',
		'JXCharInput.h',
		'JXCheckModTimeTask.h',
		'JXCheckbox.h',
		'JXCheckboxGroup.h',
		'JXCheckboxListDialog.h',
		'JXChooseColorDialog.h',
		'JXChooseEPSDestFileTask.h',
		'JXChooseFileDialog.h',
		'JXChooseFontSizeDialog.h',
		'JXChooseMonoFont.h',
		'JXChoosePathDialog.h',
		'JXChooseSaveFile.h',
		'JXCloseDirectorTask.h',
		'JXColHeaderWidget.h',
		'JXColorManager.h',
		'JXColorWheel.h',
		'JXContainer.h',
		'JXCreatePG.h',
		'JXCurrentPathMenu.h',
		'JXCursor.h',
		'JXCursorAnimationTask.h',
		'JXCursorAnimator.h',
		'JXDNDChooseDropActionDialog.h',
		'JXDNDManager.h',
		'JXDSSFinishSaveTask.h',
		'JXDSSSelection.h',
		'JXDecorRect.h',
		'JXDeleteObjectTask.h',
		'JXDialogDirector.h',
		'JXDirTable.h',
		'JXDirectSaveAction.h',
		'JXDirectSaveSource.h',
		'JXDirector.h',
		'JXDisplay.h',
		'JXDisplayMenu.h',
		'JXDockDirector.h',
		'JXDockDragData.h',
		'JXDockManager.h',
		'JXDockTabGroup.h',
		'JXDockWidget.h',
		'JXDockWindowTask.h',
		'JXDocktab.h',
		'JXDocument.h',
		'JXDocumentManager.h',
		'JXDocumentMenu.h',
		'JXDownRect.h',
		'JXDragPainter.h',
		'JXEPSPrintSetupDialog.h',
		'JXEPSPrinter.h',
		'JXEditTable.h',
		'JXEditWWWPrefsDialog.h',
		'JXEmbossedRect.h',
		'JXEngravedRect.h',
		'JXErrorDialog.h',
		'JXExpandWindowToFitContentTask.h',
		'JXFLInputBase.h',
		'JXFLRegexInput.h',
		'JXFLWildcardInput.h',
		'JXFSInputBase.h',
		'JXFTCCell.h',
		'JXFileDocument.h',
		'JXFileHistoryMenu.h',
		'JXFileInput.h',
		'JXFileListSet.h',
		'JXFileListTable.h',
		'JXFileNameDisplay.h',
		'JXFileSelection.h',
		'JXFixLenPGDirector.h',
		'JXFlatRect.h',
		'JXFloatInput.h',
		'JXFloatTable.h',
		'JXFontManager.h',
		'JXFontNameMenu.h',
		'JXFontNameMenuDirector.h',
		'JXFontNameMenuTable.h',
		'JXFontSizeMenu.h',
		'JXGC.h',
		'JXGetNewDirDialog.h',
		'JXGetStringDialog.h',
		'JXGoToLineDialog.h',
		'JXHelpManager.h',
		'JXHintDirector.h',
		'JXHintManager.h',
		'JXHistoryMenuBase.h',
		'JXHorizDockPartition.h',
		'JXHorizPartition.h',
		'JXIconDirector.h',
		'JXIdleTask.h',
		'JXImage.h',
		'JXImageButton.h',
		'JXImageCache.h',
		'JXImageCheckbox.h',
		'JXImageMask.h',
		'JXImageMenu.h',
		'JXImageMenuData.h',
		'JXImageMenuDirector.h',
		'JXImageMenuTable.h',
		'JXImagePainter.h',
		'JXImageRadioButton.h',
		'JXImageSelection.h',
		'JXImageWidget.h',
		'JXInputField.h',
		'JXIntegerInput.h',
		'JXKeyModifiers.h',
		'JXLevelControl.h',
		'JXLibVersion.h',
		'JXLinkText.h',
		'JXMDIServer.h',
		'JXMacWinPrefsDialog.h',
		'JXMenu.h',
		'JXMenuBar.h',
		'JXMenuData.h',
		'JXMenuDirector.h',
		'JXMenuItemIDUtil.th',
		'JXMenuManager.h',
		'JXMenuTable.h',
		'JXMessageDialog.h',
		'JXNamedTreeListWidget.h',
		'JXNewDirButton.h',
		'JXOKToCloseDialog.h',
		'JXOpenDisplayDialog.h',
		'JXPGDirectorBase.h',
		'JXPGMessageDirector.h',
		'JXPSPageSetupDialog.h',
		'JXPSPrintSetupDialog.h',
		'JXPSPrinter.h',
		'JXPTPageSetupDialog.h',
		'JXPTPrintSetupDialog.h',
		'JXPTPrinter.h',
		'JXPartition.h',
		'JXPasswordInput.h',
		'JXPathHistoryMenu.h',
		'JXPathInput.h',
		'JXPrefsManager.h',
		'JXProgressDisplay.h',
		'JXProgressIndicator.h',
		'JXProgressTask.h',
		'JXQuitIfAllDeactTask.h',
		'JXRadioButton.h',
		'JXRadioGroup.h',
		'JXRadioGroupDialog.h',
		'JXRaiseWindowTask.h',
		'JXRegexInput.h',
		'JXRegexReplaceInput.h',
		'JXRestorePartitionGeometry.h',
		'JXRowHeaderWidget.h',
		'JXSaveFileDialog.h',
		'JXSaveFileInput.h',
		'JXScrollTabsTask.h',
		'JXScrollableWidget.h',
		'JXScrollbar.h',
		'JXScrollbarSet.h',
		'JXScrolltab.h',
		'JXSearchTextButton.h',
		'JXSearchTextDecorTask.h',
		'JXSearchTextDialog.h',
		'JXSelectionData.h',
		'JXSelectionManager.h',
		'JXSharedPrefObject.h',
		'JXSharedPrefsManager.h',
		'JXSlider.h',
		'JXSliderBase.h',
		'JXSpellChecker.h',
		'JXSpellCheckerDialog.h',
		'JXSpellList.h',
		'JXSplashWindow.h',
		'JXStandAlonePG.h',
		'JXStaticText.h',
		'JXStringCompletionMenu.h',
		'JXStringHistoryMenu.h',
		'JXStringList.h',
		'JXStringTable.h',
		'JXStyleMenu.h',
		'JXStyleMenuDirector.h',
		'JXStyleMenuTable.h',
		'JXStyleTable.h',
		'JXStyleTableMenu.h',
		'JXStyledText.h',
		'JXTEBase.h',
		'JXTEBlinkCaretTask.h',
		'JXTEStyleMenu.h',
		'JXTLWAdjustToTreeTask.h',
		'JXTabGroup.h',
		'JXTable.h',
		'JXTextButton.h',
		'JXTextCheckbox.h',
		'JXTextEditor.h',
		'JXTextEditorSet.h',
		'JXTextMenu.h',
		'JXTextMenuData.h',
		'JXTextMenuDirector.h',
		'JXTextMenuTable.h',
		'JXTextRadioButton.h',
		'JXTextSelection.h',
		'JXTimerTask.h',
		'JXTipOfTheDayDialog.h',
		'JXToolBar.h',
		'JXToolBarButton.h',
		'JXToolBarEditDir.h',
		'JXToolBarEditWidget.h',
		'JXToolBarNode.h',
		'JXTreeListWidget.h',
		'JXUNDialogBase.h',
		'JXUpRect.h',
		'JXUpdateDocMenuTask.h',
		'JXUpdateMinSizeTask.h',
		'JXUpdateShortcutIndex.th',
		'JXUpdateWDMenuTask.h',
		'JXUrgentTask.h',
		'JXUserNotification.h',
		'JXVIKeyHandler.h',
		'JXVarLenPGDirector.h',
		'JXVertDockPartition.h',
		'JXVertPartition.h',
		'JXWDManager.h',
		'JXWDMenu.h',
		'JXWarningDialog.h',
		'JXWebBrowser.h',
		'JXWidget.h',
		'JXWidgetSet.h',
		'JXWindow.h',
		'JXWindowDirector.h',
		'JXWindowIcon.h',
		'JXWindowPainter.h',
		'JXXFontMenu.h',
		'jXActionDefs.h',
		'jXActions.h',
		'jXConstants.h',
		'jXEventUtil.h',
		'jXGlobals.h',
		'jXPainterUtil.h',
		'jXUtil.h'
	],
	'j2dplot' =>
	[
		'J2DCurveInfo.h',
		'J2DDataPoint.h',
		'J2DDataRect.h',
		'J2DPlotData.h',
		'J2DPlotDataBase.h',
		'J2DPlotFunction.h',
		'J2DPlotFunctionBase.h',
		'J2DPlotLibVersion.h',
		'J2DPlotWidget.h',
		'J2DVectorData.h',
		'J2DVectorPoint.h',
		'JX2DCursorMarkTable.h',
		'JX2DCursorMarkTableDir.h',
		'JX2DCurveNameList.h',
		'JX2DCurveOptionsDialog.h',
		'JX2DPlotEPSPrinter.h',
		'JX2DPlotLabelDialog.h',
		'JX2DPlotPrintEPSDialog.h',
		'JX2DPlotRangeDialog.h',
		'JX2DPlotScaleDialog.h',
		'JX2DPlotWidget.h'
	],
	'jexpr' =>
	[
		'JAbsValue.h',
		'JAlgSign.h',
		'JArcCosine.h',
		'JArcHypCosine.h',
		'JArcHypSine.h',
		'JArcHypTangent.h',
		'JArcSine.h',
		'JArcTangent.h',
		'JArcTangent2.h',
		'JBinaryFunction.h',
		'JBinaryOperator.h',
		'JConjugate.h',
		'JConstantValue.h',
		'JCosine.h',
		'JDivision.h',
		'JExponent.h',
		'JExprEditor.h',
		'JExprLibVersion.h',
		'JExprParser.h',
		'JExprRectList.h',
		'JExprRenderer.h',
		'JExprScanner.h',
		'JFunction.h',
		'JFunctionWithArgs.h',
		'JFunctionWithVar.h',
		'JHypCosine.h',
		'JHypSine.h',
		'JHypTangent.h',
		'JImagPart.h',
		'JLogB.h',
		'JLogE.h',
		'JMaxFunc.h',
		'JMinFunc.h',
		'JNamedConstant.h',
		'JNaryFunction.h',
		'JNaryOperator.h',
		'JNegation.h',
		'JParallel.h',
		'JPhaseAngle.h',
		'JProduct.h',
		'JRealPart.h',
		'JRotateComplex.h',
		'JRoundToInt.h',
		'JSine.h',
		'JSquareRoot.h',
		'JSummation.h',
		'JTangent.h',
		'JTruncateToInt.h',
		'JUnaryFunction.h',
		'JUserInputFunction.h',
		'JVariableList.h',
		'JVariableValue.h',
		'JXExprEditor.h',
		'JXExprEditorSet.h',
		'JXExprInput.h',
		'jFunctionUtil.h'
	],
	'jfs' =>
	[
		'JFSBinding.h',
		'JFSBindingList.h',
		'JFSFileTree.h',
		'JFSFileTreeNode.h',
		'JFSFileTreeNodeBase.h',
		'JFSLibVersion.h',
		'JXFSBindingManager.h',
		'JXFSBindingTable.h',
		'JXFSCommandHistoryMenu.h',
		'JXFSDirMenu.h',
		'JXFSEditBindingsDialog.h',
		'JXFSRunCommandDialog.h',
		'JXFSRunFileDialog.h',
		'JXFSRunScriptDialog.h'
	]
);

sub ReadFile($)
{
	local $/ = undef;
	open(F, "< $_[0]");
	return <F>;
}

open(L, "find -E . -regex '.+\.(cpp|h|tmpl|ll?|y)' |");

while (my $file = <L>)
{
	chomp($file);
	my $orig_data = my $data = ReadFile($file);

	while ($data =~ /#include ["<]([^">]+)/g)
	{
		my $f = $1;
		for my $ns (keys(%ns))
		{
			next if !($f ~~ @{%ns{$ns}});
			$data =~ s/#include (["<])$f/#include ${1}jx-af\/${ns}\/${f}/g;
		}
	}

	if ($data ne $orig_data)
	{
		open(F, "> $file");
		print F $data;
		close(F);
	}
}
